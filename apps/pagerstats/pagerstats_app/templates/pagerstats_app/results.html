{% load staticfiles %}

<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> 
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/drilldown.js"></script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="{% static 'css/myapp.css' %}">
<link href='http://fonts.googleapis.com/css?family=Maven+Pro' rel='stylesheet' type='text/css'>
</head>


<div style="padding:0px;margin:5px;height:50px;background-color:rgb(26, 188, 156);margin:0 auto; border-radius:05px;width:85%;border-radius:10px;margin: 10px auto;border:1px solid black;">
           <h1  style = "float: left;margin-left:10px;"align=center""></i><font size="5" color=black>pagerStats</font>
            </h1>
</div>




<div style="width:85%;border-radius:10px;height:50px;margin: 10px auto;border:1px solid black;">
    <div>
        <div style="display: inline-block;">
            <form id="form" action="" method="get">
                {% for i in form %}
                    <tr>
                        {% if i.auto_id == "id_idc"%}
                            &nbsp;&nbsp;<td>{{ i.label_tag }}</td>&nbsp;&nbsp;&nbsp;
                            <td>{{i}}</td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            {% endif%}
                                {% if i.auto_id == "id_shift"%} &nbsp;&nbsp;&nbsp;
                                <td>{{ i.label_tag }}</td>
                                {% for radio in form.shift %}
                                    <div style="display: inline-block;margin: 15px auto;margin-left: 10px">
                                        {{ radio }}
                                    </div>
                                {% endfor %}
                                {% endif%}
                            &nbsp;
                            {% if i.auto_id == "id_domain"%}
                                <select name="domain" id="id_domain">
                                    {% for x,y in form.fields.domain.choices %}
                                    <option value="{{ x }}">{{ y }}</option>
                                    {% endfor %}
                                </select>
                            {% endif %}

                    </tr>  
                {% endfor %}
                            &nbsp;&nbsp;&nbsp;&nbsp;
                <input id="submitbtn" type="submit" value="Submit">
                {% csrf_token %}
                <h1  style = "float: right;margin-left:520px;"align=center""></i><font size="3" color=black><b>IDC:</b>{{ shift_data.0.avg}}{{'%'}}{% if shift_data.0.avg > shift_data.1.avg%}<b style="color: red;">&#x25B2;</b> {%endif%}   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>US:</b>{{ shift_data.1.avg}}{{'%'}}</font>
            </form>
        </div>

    </div>
</div>


<div style="width:85%;border-radius:6px;height:auto;margin: 10px auto;border:1px solid black;"> 
    
    <div>
        <div style="margin-left: 0px; width:60%;display: inline-block;" >
            <div id="line"></div>
        </div>

        <div style="margin-left: 0px; width:35%;display: inline-block;"align="center" "vertical-align: middle;" >
            <div id="pie"></div>
        </div>
    </div> 

</div>


<div id="line"></div>
<div id="pie"></div>
            <div style="width:85%;border-radius:5px;height: auto;margin: 10px auto;">
            <font size="4" >&#128276;</font><font size="2"> <b><font color=red>Noise Ratio:</font></b> <u><b>IDC@{{ shift_data.0.noise_ratio}}</u></b>   &nbsp;&nbsp;&nbsp;&nbsp;  <u><b>US@{{   shift_data.1.noise_ratio}}</font></u></b>
            </div>
                    <div style="width:85%;border-radius:5px;height: auto;margin: 10px auto;border:1px solid black;"> 
                        <div>
                                <table class="table table-hover table-condensed;border-radius:10px;">

                                  <thead style="background-color:rgb(26, 188, 156);border-radius:10px;">   
                                      <th><font color=white size="2">Service Name</font></th>  
                                      <th><font color=white size="2">Alert Desc </font> </th>
                                      <th><font color=white size="2">No. Alerts</font>  </th>
                                      <th><font color=white size="2">Contribution</font>  </th>
                                      <th><font color=white size="2">Noise Ratio</font>  </th>
                                  </thead>


                                  <tbody>
                                    {% for i in insights_data %}
                                      <tr> 
                                             
                                                    <td class><font size="2"</font>{{i.service_name}}</div> 
                                                    <td class><font size="2"</font>{{i.description}}</div>
                                                    <td class><font size="2"</font>{{i.count}}</div>
                                                    <td class><font size="2"</font>{{i.avg}}{{'%'}}</div>
                                                    <td class><font size="2"</font>{{i.noise_ratio}}{% if i.noise_ratio > 0.5 %}<b style="color: red;"> &uarr;</b> {%endif%}</div>
                                    </tr>
                                    {% endfor %}
                                  </tbody>
                                </table>

                        </div>
                    </div>
                    <div style="width:85%;border-radius:5px;height: auto;margin: 10px auto;">
                        <i><font size="2" color=red>&uarr; Possible candidates to fix</font></i>
                    </div>
                    

<script>
    var data_source_wk = {{ data_source_wk|safe }}
    var service_count_wk_pie = {{ service_count_wk_pie|safe }}
    var data_source_dly = {{ data_source_dly|safe }}
    var domain = {{ domain|safe }}
</script>


<script type="text/javascript">


$(function () {    

    // Create the chart
    $('#line').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: "{{domain}}: Weekly Stats"
        },
        subtitle: {
                    text: 'Click the columns to view detail stats'
                },
        xAxis: {
            type: 'category'
        },
        yAxis: {
                    min: 0,
                    title: {
                        text: 'Total Incidents'
                    }
                },
        legend: {
            enabled: true
        },

        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                }
            }
        },
        series: [{
        name: 'Incidents',
        colorByPoint: true,
        data: [ {% for i in data_source_wk %}
                  { 
                    name: '{{i.group_date}}',
                    y:  {{ i.total }},  
                    drilldown: {{ i.drill }}
                  },
                {% endfor %}
               ]
    }], 
    drilldown: {
        series: [ {% for i in data_source_wk %}
                  {
                  id: {{ i.drill }},
                  name: 'Incidents/Service',
                  data: [
                        {% for j in data_source_dly %}
                            {% ifequal i.drill j.drill  %}
                                {
                                    name:"{{ j.service_name }}",
                                    y: {{ j.total }}
                                },
                            {%endifequal%}
                        {%endfor%}
                       ]
                  },
                  {%endfor%}

                ]
                 }



    })
});




</script>


<script type="text/javascript">


$(function () {    

    // Create the chart
    $('#pie').highcharts({
        chart: {
            type: 'pie'
        },
        title: {
            text: '{{domain}}: Service Stats'
        },
        subtitle: {
                    text: 'Total nmber of incidents/service'
                },
        xAxis: {
            type: 'category'
        },
        yAxis: {
                    min: 0,
                    title: {
                        text: 'Total Incidents'
                    }
                },
        legend: {
            enabled: true
        },

        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    formatter: function() {
                        return Math.round(this.percentage*100)/100 + ' %';
                    },
                    distance: -30,
                    color:'white'
                }
            }
        },
        series: [{
        name: 'Incidents/Service',
        colorByPoint: true,
        data: [ {% for i in service_count_wk_pie %}
                  { 
                    name: '{{i.service_name}}',
                    y:  {{ i.count }} 
                  },
                {% endfor %}
               ]
    }]

    })
});




</script>

